# To change this license header, choose License Headers in Project Properties.
# To change this template file, choose Tools | Templates
# and open the template in the editor.
#select db
db.create=CREATE DATABASE IF NOT EXISTS {0}
db.use = use {0}

#create tables
db.table.services = CREATE TABLE IF NOT EXISTS `services` (`id` int(11) unsigned NOT NULL AUTO_INCREMENT,`title` varchar(200) NOT NULL,PRIMARY KEY (`id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;   
db.table.users = CREATE TABLE IF NOT EXISTS `users` (`user_id` varchar(200) NOT NULL, `subscriber_user_id` varchar(200) NOT NULL, `reference_username` varchar(200) NOT NULL, `created_on` int(11) unsigned NOT NULL, `modified_on` int(11) unsigned NOT NULL, PRIMARY KEY (`user_id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;
db.table.subscribers = CREATE TABLE IF NOT EXISTS `subscribers` (`user_id` varchar(200) NOT NULL, `op_code` varchar(200) NOT NULL, `ls_identifier` varchar(200) NOT NULL, `base_url` varchar(500) NOT NULL, `registration_date` int(11) unsigned NOT NULL,`expired_date` int(11) unsigned NOT NULL,`max_members` int(11) unsigned NOT NULL,`ip_address` varchar(200) NOT NULL,PRIMARY KEY (`user_id`),KEY `fk_subscribers1_idx` (`user_id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;
db.table.subscribers_services = CREATE TABLE IF NOT EXISTS `subscribers_services` (`subscriber_user_id` varchar(200) NOT NULL, `service_id` int(11) unsigned NOT NULL, `process_type_id` int(11) unsigned NOT NULL DEFAULT 1,`api_key` varchar(200) NOT NULL,`registration_date` int(11) unsigned NOT NULL,`expired_date` int(11) unsigned NOT NULL,UNIQUE KEY `uk_subscribers_services` (`subscriber_user_id`,`service_id`),KEY `fk_subscribers_services1_idx` (`subscriber_user_id`),KEY `fk_subscribers_services2_idx` (`service_id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;
db.table.sim_services = CREATE TABLE IF NOT EXISTS `sim_services` (`id` int(11) unsigned NOT NULL AUTO_INCREMENT,`title` varchar(200) NOT NULL,PRIMARY KEY (`id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;
db.table.sims = CREATE TABLE IF NOT EXISTS `sims` (`sim_no` varchar(200) NOT NULL, `identifier` varchar(200) NOT NULL, `description` varchar(500) NOT NULL, `status` int(11) unsigned NOT NULL, `created_on` int(11) unsigned NOT NULL, `modified_on` int(11) unsigned NOT NULL, PRIMARY KEY (`sim_no`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;
db.table.sims_services = CREATE TABLE IF NOT EXISTS `sims_services` (`sim_no` varchar(200) NOT NULL, `service_id` int(11) unsigned NOT NULL, `category_id` int(11) unsigned NOT NULL, `current_balance` double DEFAULT 0, `created_on` int(11) unsigned NOT NULL, `modified_on` int(11) unsigned NOT NULL, UNIQUE KEY `uk_sims_services` (`sim_no`,`service_id`), KEY `fk_sims_services1_idx` (`sim_no`), KEY `fk_sims_services2_idx` (`service_id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;
db.table.sim_load_transactions = CREATE TABLE IF NOT EXISTS `sim_load_transactions` (`id` int(11) unsigned NOT NULL AUTO_INCREMENT, `sim_no` varchar(200) NOT NULL, `service_id` int(11) unsigned NOT NULL, `amount` double DEFAULT 0, `date` int(11) unsigned NOT NULL, `created_on` int(11) unsigned NOT NULL, `modified_on` int(11) unsigned NOT NULL, PRIMARY KEY (`id`), KEY `fk_sim_load_transactions1_idx` (`sim_no`), KEY `fk_sim_load_transactions2_idx` (`service_id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;
db.table.callback_functions =  CREATE TABLE IF NOT EXISTS `callback_functions` (`api_key` varchar(200) NOT NULL, `callback_function` varchar(1000) NOT NULL, PRIMARY KEY (`api_key`), KEY `fk_callback_functions1_idx` (`api_key`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;
db.table.transaction_statuses = CREATE TABLE IF NOT EXISTS `transaction_statuses` (`id` int(11) unsigned NOT NULL AUTO_INCREMENT, `title` varchar(200) NOT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1; 
db.table.transaction_types = CREATE TABLE IF NOT EXISTS `transaction_types` (`id` int(11) unsigned NOT NULL AUTO_INCREMENT, `title` varchar(200) NOT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1; 
db.table.sms_details = CREATE TABLE IF NOT EXISTS `sms_details` (`id` int(11) unsigned NOT NULL AUTO_INCREMENT, `api_key` varchar(200) NOT NULL, `transaction_id` varchar(200), `sms` text, `length` int(11), `unit_price` double, `created_on` int(11) unsigned DEFAULT NULL, `modified_on` int(11) unsigned DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;
db.table.sms_transactions = CREATE TABLE IF NOT EXISTS `sms_transactions` (`id` int(11) unsigned NOT NULL AUTO_INCREMENT, `transaction_id` varchar(200), `sender_cell_no` varchar(100), `cell_no` varchar(20), `status_id` int(11) unsigned NOT NULL, `created_on` int(11) unsigned DEFAULT NULL, `modified_on` int(11) unsigned DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1; 
db.table.transactions =  CREATE TABLE IF NOT EXISTS `transactions` (`transaction_id` varchar(200) NOT NULL, `api_key` varchar(200) NOT NULL, `balance_in` double DEFAULT 0, `balance_out` double DEFAULT 0, `status_id` int(11) unsigned NOT NULL, `type_id` int(11) unsigned NOT NULL, `package_id` int(11) unsigned NOT NULL DEFAULT 1, `sender_cell_no` varchar(200) DEFAULT '',`trx_id_operator` varchar(200) DEFAULT '', `cell_no` varchar(200) NOT NULL, `description` varchar(500) NOT NULL, `created_on` int(11) unsigned NOT NULL, `modified_on` int(11) unsigned NOT NULL, `editable` BOOLEAN DEFAULT FALSE , PRIMARY KEY (`transaction_id`), KEY `fk_transactions1_idx` (`status_id`), KEY `fk_transactions2_idx` (`type_id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;
db.table.sims_messages = CREATE TABLE IF NOT EXISTS `sims_messages` (`id` int(11) unsigned NOT NULL AUTO_INCREMENT, `country_code` varchar(200), `sim_no` varchar(200), `sender` varchar(200), `sms` text, `created_on` int(11) unsigned DEFAULT NULL, `modified_on` int(11) unsigned DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;

#create relations
db.rel.subscribers = ALTER TABLE `subscribers` ADD CONSTRAINT `fk_subscribers1` FOREIGN KEY (`user_id`) REFERENCES `users` (`user_id`) ON DELETE CASCADE ON UPDATE CASCADE;
db.rel.subscribers_services = ALTER TABLE `subscribers_services` ADD CONSTRAINT `fk_subscribers_services1` FOREIGN KEY (`subscriber_user_id`) REFERENCES `users` (`user_id`) ON DELETE CASCADE ON UPDATE CASCADE, ADD CONSTRAINT `fk_subscribers_services2` FOREIGN KEY (`service_id`) REFERENCES `services` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;
db.rel.sims_services = ALTER TABLE `sims_services` ADD CONSTRAINT `fk_sims_services1` FOREIGN KEY (`sim_no`) REFERENCES `sims` (`sim_no`) ON DELETE CASCADE ON UPDATE CASCADE, ADD CONSTRAINT `fk_sims_services2` FOREIGN KEY (`service_id`) REFERENCES `sim_services` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;
db.rel.sim_load_transactions = ALTER TABLE `sim_load_transactions` ADD CONSTRAINT `fk_sim_load_transactions1` FOREIGN KEY (`sim_no`) REFERENCES `sims` (`sim_no`) ON DELETE CASCADE ON UPDATE CASCADE, ADD CONSTRAINT `fk_sim_load_transactions2` FOREIGN KEY (`service_id`) REFERENCES `services` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;
db.rel.sms_transactions = ALTER TABLE `sms_transactions` ADD CONSTRAINT `fk_sms_transactions1` FOREIGN KEY (`status_id`) REFERENCES `transaction_statuses` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;
db.rel.transactions = ALTER TABLE `transactions` ADD CONSTRAINT `fk_transactions1` FOREIGN KEY (`status_id`) REFERENCES `transaction_statuses` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, ADD CONSTRAINT `fk_transactions2` FOREIGN KEY (`type_id`) REFERENCES `transaction_types` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

#insert default data
db.defaultData.services = INSERT INTO `services` (`id`, `title`) VALUES (1, 'BKash CashIn'), (2, 'DBBL CashIn'), (3, 'MCash CashIn'), (4, 'UCash CashIn'), (101, 'Topup GP'), (102, 'Topup ROBI'), (103, 'Topup BanglaLink'), (104, 'Topup Airtel'), (105, 'Topup TeleTalk'), (1001, 'Send SMS');
db.defaultData.sim_services = INSERT INTO `sim_services` (`id`, `title`) VALUES (1, 'BKash'), (2, 'DBBL'), (3, 'MCash'), (4, 'UCash'), (101, 'GP'), (102, 'ROBI'), (103, 'BanglaLink'), (104, 'Airtel'), (105, 'TeleTalk');
db.defaultData.users = INSERT INTO `users` (`user_id`, `subscriber_user_id`, `reference_username`, `created_on`, `modified_on`) VALUES ('1', '1', 'admin', 1392232479, 1392232479);
db.defaultData.subscribers = INSERT INTO `subscribers` (`user_id`, `op_code`, `ls_identifier`, `base_url`, `registration_date`, `expired_date`, `max_members`, `ip_address`) VALUES ('1', 'democ1', 'demols1', 'http://localhost/rechargeserver/', 1392232479, 2140000000, 500, '192.168.1.1');
db.defaultData.subscribers_services = INSERT INTO `subscribers_services` (`subscriber_user_id`, `service_id`, `api_key`, `registration_date`, `expired_date`) VALUES ('1', 1, 'demokey1', 1392232479, 2140000000), ('1', 2, 'demokey2', 1392232479, 2140000000), ('1', 3, 'demokey3', 1392232479, 2140000000), ('1', 4, 'demokey4', 1392232479, 2140000000), ('1', 101, 'demokey101', 1392232479, 2140000000), ('1', 102, 'demokey102', 1392232479, 2140000000), ('1', 103, 'demokey103', 1392232479, 2140000000), ('1', 104, 'demokey104', 1392232479, 2140000000), ('1', 105, 'demokey105', 1392232479, 2140000000), ('1', 1001, 'demokey1001', 1392232479, 2140000000);
db.defaultData.callback_functions = INSERT INTO `callback_functions` (`api_key`, `callback_function`) VALUES ('key1', 'callback1');
db.defaultData.transaction_statuses = INSERT INTO `transaction_statuses` (`id`, `title`) VALUES (1, 'Pending'), (2, 'Success'), (3, 'Failed'), (4, 'Cancelled'), (5, 'Processed');
db.defaultData.transaction_types = INSERT INTO `transaction_types` (`id`, `title`) VALUES (1, 'Raise Balance'), (2, 'Use Service');
#db.defaultData.transactions = INSERT INTO `transactions` (`transaction_id`, `api_key`, `balance_in`, `balance_out`, `status_id`, `type_id`, `cell_no`, `description`, `created_on`, `modified_on`) VALUES ('t1', 'key1', 100000, 0, 2, 1, '', '', 1392232479, 1392232479), ('t2', 'key1', 0, 5000, 1, 2, '01678112509', 'description1', 1392232479, 1392232479);